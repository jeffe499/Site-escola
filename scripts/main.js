(function(){'use strict';function qs(s){return document.querySelector(s)}function qsa(s){return Array.from(document.querySelectorAll(s))}function parseEmbedded(id,fallback){try{var el=document.getElementById(id);if(!el)return fallback;var txt=el.textContent.trim();return txt?JSON.parse(txt):fallback}catch(e){console.warn('parse error',e);return fallback}}var yearEls=qsa('#year');yearEls.forEach(function(e){e.textContent=new Date().getFullYear()});fetch('data/school.json',{cache:'no-store'}).then(function(r){if(!r.ok)throw 1;return r.json()}).catch(function(){return parseEmbedded('embedded-school',{})}).then(function(school){if(!school)return;if(qs('#school-name'))qs('#school-name').textContent=school.name||qs('#school-name').textContent;if(qs('#contact-block'))qs('#contact-block').innerHTML='<strong>Telefone:</strong> '+(school.phone||'—')+'<br><strong>Email:</strong> '+(school.email||'—');if(qs('#director-block'))qs('#director-block').textContent=school.director||'—';if(qs('#inep-block'))qs('#inep-block').textContent=school.inep||'—';if(qs('#footer-address'))qs('#footer-address').textContent=(school.address?school.address+' • CEP '+(school.cep||'—'):'—');if(qs('#stat-students'))qs('#stat-students').textContent=school.students||'—';if(qs('#stat-teachers'))qs('#stat-teachers').textContent=school.teachers||'—';if(qs('#stat-projects'))qs('#stat-projects').textContent=school.projects||'—';if(school.motto&&qs('#hero-sub'))qs('#hero-sub').textContent=school.motto});fetch('data/projects.json',{cache:'no-store'}).then(function(r){if(!r.ok)throw 1;return r.json()}).then(function(pjs){if(pjs&&qs('#stat-projects'))qs('#stat-projects').textContent=pjs.length}).catch(function(){});window.siteAPI={openModal:function(html){var modal=qs('#modal');if(!modal)return;qs('#modal-content').innerHTML=html;modal.setAttribute('aria-hidden','false');modal.scrollTop=0},closeModal:function(){var modal=qs('#modal');if(!modal)return;modal.setAttribute('aria-hidden','true');qs('#modal-content').innerHTML=''}};var modal=qs('#modal');if(modal){qs('#modal-close').addEventListener('click',function(){window.siteAPI.closeModal()});document.addEventListener('keydown',function(e){if(e.key==='Escape')window.siteAPI.closeModal()});modal.addEventListener('click',function(e){if(e.target===modal)window.siteAPI.closeModal()})}var searchBtn=qs('#search-btn');if(searchBtn){searchBtn.addEventListener('click',function(){var q=(qs('#search-input').value||'').trim().toLowerCase();var newsItems=qsa('.news-item');if(!q){newsItems.forEach(n=>n.style.display='');return}newsItems.forEach(function(n){var txt=(n.textContent||'').toLowerCase();n.style.display=txt.indexOf(q)===-1?'none':''})})}var newsletter=qs('#newsletter-form');if(newsletter){newsletter.addEventListener('submit',function(e){e.preventDefault();var email=this.email.value.trim();var msg=qs('#newsletter-msg');if(!email){if(msg)msg.textContent='Email inválido.';return}var list=JSON.parse(localStorage.getItem('newsletter')||'[]');if(list.includes(email)){if(msg)msg.textContent='Email já cadastrado.';this.reset();return}list.push(email);localStorage.setItem('newsletter',JSON.stringify(list));if(msg)msg.textContent='Inscrição realizada! Obrigado.';this.reset()})}var contact=qs('#contact-form');if(contact){contact.addEventListener('submit',function(e){e.preventDefault();var f=this;var data={nome:f.nome.value.trim(),email:f.email.value.trim(),assunto:f.assunto.value.trim(),mensagem:f.mensagem.value.trim(),date:new Date().toISOString()};if(!data.nome||!data.email||!data.mensagem){alert('Preencha os campos obrigatórios.');return}var msgs=JSON.parse(localStorage.getItem('messages')||'[]');msgs.push(data);localStorage.setItem('messages',JSON.stringify(msgs));alert('Mensagem enviada. Obrigado, '+data.nome+'! (salva localmente)');f.reset()});var showBtn=qs('#show-messages');if(showBtn){showBtn.addEventListener('click',function(){var msgs=JSON.parse(localStorage.getItem('messages')||'[]');var box=qs('#saved-messages');box.hidden=false;if(msgs.length===0){box.innerHTML='<p class="muted">Nenhuma mensagem encontrada.</p>';return}box.innerHTML=msgs.map(function(m){return '<div class="card" style="margin-bottom:8px;padding:10px"><strong>'+escapeHtml(m.nome)+'</strong> • <small>'+new Date(m.date).toLocaleString()+'</small><p>'+escapeHtml(m.mensagem)+'</p></div>'}).join('')})}function escapeHtml(s){if(!s)return'';return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}})();